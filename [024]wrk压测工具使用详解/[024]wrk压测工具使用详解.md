## 压测相关的几个概念

### QPS 和 TPS

1. QPS: queries per seconds 也就是"每秒查询率",是一台机器每秒能够响应的查询次数,是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准
2. TPS: transactions per seconds 也就是每秒的事务数,它是软件测试结果的测量单位,一个事务是指一个客户机向服务器发送请求然后服务器作出反应的过程.客户机在发送请求时开始计时,收到服务器响应后结束计时,以此来计算使用的时间和完成的事务个数

> QPS 类似 TPS,但是不同的是,对于一个页面的一次访问,形成一个 TPS,但是一次页面请求,可能会产生多次的服务器的请求,服务器对这些请求,就可计入 QPS 之中
> 例如,访问一个页面会请求服务器 3 次,那么一次请求,就会产品一个 TPS,三个 QPS
> 对于一般的测试软件结果而言,TPS === QPS(可以这么认为)

### 并发连接数和请求数

1. 并发连接数指的是客户端向服务器发起请求,并建立 TCP 连接.每秒服务器连接的总 TCP 数量,就是并发连接数
2. 请求数指的是客户端在建立完连接后,想服务器发起 GET/POST/HEAD 数据包,服务端返回了请求结果后有 2 中情况:
   1. http 数据包头包含 close 字样,关闭本次 TCP 连接
   2. http 数据包头包含 keep-alive 字样,本次连接不关闭,可继续通过该连接继续向 http 服务器发送请求,用于减少 TCP 并发连接数

## 服务器性能怎么测

通常情况下,我们测试的是 QPS,也就是每秒请求数,不过为了衡量服务器的总体性能,测试时最好一起测试并发连接数和请求数

1. 测试并发连接数采用每个并发一个请求,多个并发进行
2. 测试请求数采用多并发,每个并发多个请求进行,总的请求数=并发数\*单并发请求数,需要注意的是,不同的并发和单并发请求得出的结果会不同,因此最好多测试几次取平均值

## wrk 基本用法简介

wrk 的基础介绍和安装基本流程这里不做介绍,接下来只列举下 wrk 基本的用法.

```bash
$ wrk -h
wrk: invalid option -- h
Usage: wrk <options> <url>
  Options:
    -c, --connections <N>  Connections to keep open
    -d, --duration    <T>  Duration of test
    -t, --threads     <N>  Number of threads to use

    -s, --script      <S>  Load Lua script file
    -H, --header      <H>  Add header to request
        --latency          Print latency statistics
        --timeout     <T>  Socket/request timeout
    -v, --version          Print version details
```
